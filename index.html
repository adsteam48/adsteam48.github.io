<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>yiyf667 „ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ</title>

<!-- „Åì„Åì„Å´„Äå„ÅÇ„Å™„Åü„ÅåÊúÄÂàù„Å´Ë≤º„Å£„ÅüCSS„Äç„Çí„Åù„ÅÆ„Åæ„ÅæË≤º„Çã -->
</head>
<body>

<div class="container">
    <div class="header">
        <h1><span class="sparkle">‚ú®</span>yiyf667„ÅÆ„Çπ„ÉÜ„Éº„Çø„Çπ<span class="sparkle">‚ú®</span></h1>
        <p class="subtitle">„É™„Ç¢„É´„Çø„Ç§„É†Êõ¥Êñ∞‰∏≠</p>
    </div>

    <div class="status-card">
        <div class="banner"></div>

        <div class="card-content">
            <div class="avatar-wrapper">
                <div class="avatar">
                    <img id="avatar" style="display:none;">
                    <div class="status-badge offline" id="avatar-status-badge"></div>
                </div>
            </div>

            <div class="user-info">
                <div class="username" id="username">yiyf667</div>
                <div class="user-tag">@yiyf667</div>
            </div>

            <div id="about-section" class="section" style="display:none;">
                <div class="section-title">Ëá™Â∑±Á¥π‰ªã</div>
                <div class="bio" id="about-text"></div>
            </div>

            <div id="activity-section" class="section" style="display:none;">
                <div class="section-title">„Ç¢„ÇØ„ÉÜ„Ç£„Éì„ÉÜ„Ç£</div>
                <div id="activities-container"></div>
            </div>

            <div class="footer">
                <div class="last-update">
                    üïê <span id="last-update">--:--:--</span>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
/* ===============================
   Ë®≠ÂÆö
================================ */
const API_URL = '/api';
const REFRESH_INTERVAL = 5000;
const DISCORD_USER_ID = '1403167996607725629';

/* ===============================
   „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£
================================ */
function formatElapsedTime(seconds) {
    if (!seconds || seconds < 0) return '0:00';
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = Math.floor(seconds % 60);
    return h > 0
        ? `${h}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`
        : `${m}:${String(s).padStart(2,'0')}`;
}

/* ===============================
   APIÂèñÂæó
================================ */
async function fetchStatus() {
    try {
        const res = await fetch(`${API_URL}/status/id/${DISCORD_USER_ID}`);
        if (!res.ok) throw new Error('API error');
        const data = await res.json();
        updateUI(data);
        updateLastUpdate();
    } catch (e) {
        console.error(e);
        document.getElementById('username').textContent = 'Êé•Á∂ö„Ç®„É©„Éº';
    }
}

/* ===============================
   UIÊõ¥Êñ∞
================================ */
function updateUI(data) {
    // username
    document.getElementById('username').textContent =
        data.username || 'yiyf667';

    // avatar
    if (data.avatar_url) {
        const avatar = document.getElementById('avatar');
        avatar.src = data.avatar_url;
        avatar.style.display = 'block';
    }

    // status badgeÔºàCSS‰ªª„ÅõÔºâ
    const badge = document.getElementById('avatar-status-badge');
    if (badge && data.status) {
        badge.className = `status-badge ${data.status}`;
    }

    // about
    const about = document.getElementById('about-section');
    if (data.about) {
        about.style.display = 'block';
        document.getElementById('about-text').textContent = data.about;
    } else {
        about.style.display = 'none';
    }

    // activities
    const section = document.getElementById('activity-section');
    const container = document.getElementById('activities-container');
    container.innerHTML = '';

    if (data.activities && data.activities.length) {
        section.style.display = 'block';

        data.activities.forEach(a => {
            const card = document.createElement('div');
            card.className = 'activity';

            const elapsed = a.start_timestamp
                ? formatElapsedTime((Date.now()/1000) - a.start_timestamp)
                : '0:00';

            card.innerHTML = `
                <div class="activity-icon">üéÆ</div>
                <div class="activity-info">
                    <div class="activity-name">${a.name}</div>
                    <div class="activity-details">${a.state || a.details || ''}</div>
                </div>
                <div class="activity-time">
                    <div class="elapsed-time">${elapsed}</div>
                    <div class="time-label">ÁµåÈÅéÊôÇÈñì</div>
                </div>
            `;
            container.appendChild(card);
        });
    } else {
        section.style.display = 'none';
    }
}

function updateLastUpdate() {
    document.getElementById('last-update')
        .textContent = new Date().toLocaleTimeString('ja-JP');
}

/* ===============================
   ÂàùÊúüÂåñ
================================ */
fetchStatus();
setInterval(fetchStatus, REFRESH_INTERVAL);
</script>

</body>
</html>
