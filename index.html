<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Fortnite ã‚µãƒ¼ãƒãƒ¼ç¨¼åƒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
  font-family: system-ui, sans-serif;
  background:#0f172a;
  color:#e5e7eb;
  padding:20px;
}
h1,h2 { text-align:center; }
.overall {
  text-align:center;
  font-size:18px;
  font-weight:bold;
  padding:12px;
  border-radius:10px;
  margin:16px 0;
}
.ok { background:#052e16; color:#22c55e; }
.down { background:#450a0a; color:#ef4444; }

table {
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
  font-size:14px;
}
th,td {
  border-bottom:1px solid #1e293b;
  padding:8px;
  text-align:center;
}
</style>
</head>
<body>

<h1>ğŸ® Fortnite ã‚µãƒ¼ãƒãƒ¼ç¨¼åƒçŠ¶æ³</h1>
<div id="overall" class="overall">ç¢ºèªä¸­...</div>

<h2>ğŸ“† æœŸé–“ã‚µãƒãƒªãƒ¼ï¼ˆ12/01 ï½ 01/01ï¼‰</h2>
<table>
<thead>
<tr><th>é …ç›®</th><th>å†…å®¹</th></tr>
</thead>
<tbody id="period"></tbody>
</table>

<h2>ğŸ“Š æœˆåˆ¥ ç¨¼åƒç‡</h2>
<table>
<thead>
<tr><th>æœˆ</th><th>ç¨¼åƒç‡</th><th>ç¨¼åƒæ—¥/æ—¥æ•°</th></tr>
</thead>
<tbody id="monthly"></tbody>
</table>

<h2>ğŸ“… æ—¥åˆ¥ å±¥æ­´</h2>
<table>
<thead>
<tr><th>æ—¥ä»˜</th><th>çŠ¶æ…‹</th><th>éšœå®³ç™ºç”Ÿæ™‚åˆ»</th></tr>
</thead>
<tbody id="daily"></tbody>
</table>

<script>
const STATUS_URL = "https://status.epicgames.com/api/v2/components.json";
const HISTORY_KEY = "fortnite_daily_history";
const OUTAGE_KEY = "fortnite_outage_since";

/* ---------- å…±é€š ---------- */
function today() {
  return new Date().toISOString().slice(0,10);
}
function msToTime(ms) {
  const min = Math.floor(ms/60000);
  return `${Math.floor(min/60)}æ™‚é–“ ${min%60}åˆ†`;
}

/* ---------- ç¾åœ¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ ---------- */
async function isDownNow() {
  const res = await fetch(STATUS_URL);
  const data = await res.json();
  return data.components
    .filter(c=>c.name.toLowerCase().includes("fortnite"))
    .some(f=>f.status!=="operational");
}

/* ---------- ä¿å­˜ ---------- */
function saveDaily(status,outageTime) {
  const h = JSON.parse(localStorage.getItem(HISTORY_KEY)||"{}");
  h[today()] = { status, outageTime };
  localStorage.setItem(HISTORY_KEY, JSON.stringify(h));
}

/* ---------- è¡¨ç¤º ---------- */
function renderDaily() {
  const h = JSON.parse(localStorage.getItem(HISTORY_KEY)||"{}");
  const tb = document.getElementById("daily");
  tb.innerHTML="";
  Object.keys(h).sort().reverse().forEach(d=>{
    tb.innerHTML+=`
      <tr>
        <td>${d}</td>
        <td>${h[d].status}</td>
        <td>${h[d].outageTime||"-"}</td>
      </tr>`;
  });
}

function renderMonthly() {
  const h = JSON.parse(localStorage.getItem(HISTORY_KEY)||"{}");
  const m = {};
  Object.keys(h).forEach(d=>{
    const k=d.slice(0,7);
    if(!m[k]) m[k]={t:0,u:0};
    m[k].t++;
    if(h[d].status==="ç¨¼åƒ") m[k].u++;
  });
  const tb=document.getElementById("monthly");
  tb.innerHTML="";
  Object.keys(m).sort().reverse().forEach(k=>{
    tb.innerHTML+=`
      <tr>
        <td>${k}</td>
        <td>${((m[k].u/m[k].t)*100).toFixed(1)}%</td>
        <td>${m[k].u}/${m[k].t}</td>
      </tr>`;
  });
}

/* ---------- æœŸé–“ã‚µãƒãƒªãƒ¼ ---------- */
function renderPeriod() {
  const h = JSON.parse(localStorage.getItem(HISTORY_KEY)||"{}");
  const start=new Date("2025-12-01");
  const end=new Date("2026-01-01");

  let outage=0,recover=0,downMs=0;
  let cur=null;

  Object.keys(h).sort().forEach(d=>{
    const day=new Date(d);
    if(day<start||day>end) return;

    if(h[d].status==="ä¸å‹•" && !cur){
      outage++;
      cur=new Date(h[d].outageTime);
    }
    if(h[d].status==="ç¨¼åƒ" && cur){
      recover++;
      downMs+=day-cur;
      cur=null;
    }
  });

  document.getElementById("period").innerHTML=`
    <tr><td>éšœå®³ç™ºç”Ÿå›æ•°</td><td>${outage} å›</td></tr>
    <tr><td>å†é–‹å›æ•°</td><td>${recover} å›</td></tr>
    <tr><td>åˆè¨ˆãƒ€ã‚¦ãƒ³ã‚¿ã‚¤ãƒ </td><td>${msToTime(downMs)}</td></tr>
  `;
}

/* ---------- ãƒ¡ã‚¤ãƒ³ ---------- */
async function main(){
  const down=await isDownNow();
  const o=document.getElementById("overall");

  if(down){
    o.textContent="ğŸ”´ ç¾åœ¨ï¼šéšœå®³ç™ºç”Ÿä¸­";
    o.className="overall down";
    let t=localStorage.getItem(OUTAGE_KEY);
    if(!t){ t=new Date().toLocaleString(); localStorage.setItem(OUTAGE_KEY,t); }
    saveDaily("ä¸å‹•",t);
  }else{
    o.textContent="ğŸŸ¢ ç¾åœ¨ï¼šæ­£å¸¸ç¨¼åƒä¸­";
    o.className="overall ok";
    localStorage.removeItem(OUTAGE_KEY);
    saveDaily("ç¨¼åƒ","-");
  }

  renderDaily();
  renderMonthly();
  renderPeriod();
}

main();
</script>

</body>
</html>
