<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Discordã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Courier New', 'Consolas', monospace;
    background: #0a0e27;
    background-image: 
        repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0, 255, 0, 0.03) 2px, rgba(0, 255, 0, 0.03) 4px),
        radial-gradient(ellipse at center, #0a0e27 0%, #000000 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    position: relative;
    overflow: hidden;
}

body::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0, 255, 0, 0.05) 2px,
        rgba(0, 255, 0, 0.05) 4px
    );
    pointer-events: none;
    animation: scanlines 8s linear infinite;
}

@keyframes scanlines {
    0% { transform: translateY(0); }
    100% { transform: translateY(100px); }
}

.container {
    width: 100%;
    max-width: 500px;
    position: relative;
    z-index: 1;
}

.schedule-slider {
    position: fixed;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    width: 280px;
    max-height: 80vh;
    overflow-y: auto;
    overflow-x: hidden;
    z-index: 10;
    padding-right: 5px;
}

.schedule-slider::-webkit-scrollbar {
    width: 6px;
}

.schedule-slider::-webkit-scrollbar-track {
    background: rgba(0, 255, 65, 0.1);
    border-radius: 3px;
}

.schedule-slider::-webkit-scrollbar-thumb {
    background: rgba(0, 255, 65, 0.3);
    border-radius: 3px;
}

.schedule-slider::-webkit-scrollbar-thumb:hover {
    background: rgba(0, 255, 65, 0.5);
}

.schedule-item {
    background: rgba(10, 14, 39, 0.95);
    border: 1px solid rgba(0, 255, 65, 0.3);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 0 20px rgba(0, 255, 65, 0.2);
    position: relative;
    overflow: hidden;
    transition: all 0.3s ease;
}

.schedule-item:hover {
    transform: translateX(-5px);
    box-shadow: 0 0 30px rgba(0, 255, 65, 0.4);
    border-color: rgba(0, 255, 65, 0.5);
}

.schedule-item:last-child {
    margin-bottom: 0;
}

.schedule-item::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 4px;
    background: linear-gradient(to bottom, #00ff41, transparent);
}

@keyframes slideIn {
    from {
        opacity: 0;
        transform: translateX(50px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.schedule-date {
    font-size: 0.85rem;
    color: #00ff41;
    font-weight: 700;
    margin-bottom: 8px;
    text-shadow: 0 0 5px #00ff41;
    display: flex;
    align-items: center;
    gap: 8px;
}

.schedule-date-icon {
    font-size: 1.2rem;
}

.schedule-title {
    font-size: 1rem;
    color: #00ff41;
    font-weight: 600;
    margin-bottom: 5px;
    text-shadow: 0 0 5px rgba(0, 255, 65, 0.5);
}

.schedule-desc {
    font-size: 0.85rem;
    color: rgba(0, 255, 65, 0.7);
    line-height: 1.4;
}

.schedule-time {
    font-size: 0.75rem;
    color: rgba(0, 255, 65, 0.5);
    margin-top: 5px;
    font-style: italic;
}

.header {
    text-align: center;
    margin-bottom: 30px;
    color: #00ff41;
    text-shadow: 0 0 10px #00ff41, 0 0 20px #00ff41;
}

.header h1 {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 8px;
    letter-spacing: 2px;
    animation: glitch 3s infinite;
}

@keyframes glitch {
    0%, 90%, 100% { transform: translate(0); }
    92% { transform: translate(-2px, 2px); }
    94% { transform: translate(2px, -2px); }
    96% { transform: translate(-2px, -2px); }
    98% { transform: translate(2px, 2px); }
}

.sparkle {
    display: inline-block;
    animation: sparkle-hacker 2s ease-in-out infinite;
    color: #00ff41;
}

@keyframes sparkle-hacker {
    0%, 100% { opacity: 1; text-shadow: 0 0 5px #00ff41; }
    50% { opacity: 0.3; text-shadow: 0 0 20px #00ff41; }
}

.subtitle {
    font-size: 0.95rem;
    opacity: 0.8;
    color: #00ff41;
    text-transform: uppercase;
    letter-spacing: 3px;
    margin-bottom: 15px;
}

.admin-only-warning {
    background: rgba(255, 0, 0, 0.1);
    border: 3px solid rgba(255, 0, 0, 0.6);
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 15px;
    animation: pulse-danger 1.5s ease-in-out infinite;
    box-shadow: 0 0 30px rgba(255, 0, 0, 0.4);
}

@keyframes pulse-danger {
    0%, 100% { 
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
        border-color: rgba(255, 0, 0, 0.6);
        transform: scale(1);
    }
    50% { 
        box-shadow: 0 0 40px rgba(255, 0, 0, 0.8);
        border-color: rgba(255, 0, 0, 1);
        transform: scale(1.02);
    }
}

.warning-icon {
    font-size: 3rem;
    animation: rotate-warning 4s linear infinite;
}

@keyframes rotate-warning {
    0%, 90%, 100% { transform: rotate(0deg); }
    92% { transform: rotate(-15deg); }
    94% { transform: rotate(15deg); }
    96% { transform: rotate(-15deg); }
    98% { transform: rotate(15deg); }
}

.warning-content {
    flex: 1;
}

.warning-title {
    color: #ff4141;
    font-size: 1.2rem;
    font-weight: 700;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 2px;
    text-shadow: 0 0 10px #ff4141;
}

.warning-text {
    color: #ff6b6b;
    font-size: 0.95rem;
    line-height: 1.6;
    text-shadow: 0 0 5px rgba(255, 65, 65, 0.5);
}

.security-notice {
    background: rgba(255, 193, 7, 0.1);
    border: 2px solid rgba(255, 193, 7, 0.5);
    border-radius: 8px;
    padding: 15px;
    margin-top: 15px;
    display: flex;
    align-items: center;
    gap: 12px;
    animation: pulse-warning 2s ease-in-out infinite;
}

@keyframes pulse-warning {
    0%, 100% { 
        box-shadow: 0 0 10px rgba(255, 193, 7, 0.3);
        border-color: rgba(255, 193, 7, 0.5);
    }
    50% { 
        box-shadow: 0 0 25px rgba(255, 193, 7, 0.6);
        border-color: rgba(255, 193, 7, 0.8);
    }
}

.security-icon {
    font-size: 2rem;
    animation: shake 3s ease-in-out infinite;
}

@keyframes shake {
    0%, 90%, 100% { transform: translateX(0); }
    92%, 96% { transform: translateX(-5px); }
    94%, 98% { transform: translateX(5px); }
}

.security-text {
    color: #ffc107;
    font-size: 0.9rem;
    line-height: 1.5;
    text-shadow: 0 0 5px rgba(255, 193, 7, 0.5);
}

.status-card {
    background: rgba(10, 14, 39, 0.95);
    border-radius: 16px;
    overflow: hidden;
    box-shadow: 
        0 0 40px rgba(0, 255, 65, 0.3),
        inset 0 0 40px rgba(0, 255, 65, 0.05),
        0 20px 60px rgba(0,0,0,0.5);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    border: 1px solid rgba(0, 255, 65, 0.3);
    position: relative;
}

.status-card::before {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    background: linear-gradient(45deg, #00ff41, #00ff41, transparent, transparent);
    border-radius: 16px;
    z-index: -1;
    animation: border-rotate 4s linear infinite;
    opacity: 0.5;
}

@keyframes border-rotate {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.banner {
    height: 100px;
    background: linear-gradient(135deg, #001a0d 0%, #00ff41 100%);
    position: relative;
    overflow: hidden;
}

.banner::before {
    content: '01010101 01110011 01111001 01110011 01110100 01100101 01101101';
    position: absolute;
    top: 50%;
    left: 0;
    transform: translateY(-50%);
    color: rgba(0, 255, 65, 0.2);
    font-size: 0.7rem;
    white-space: nowrap;
    animation: matrix-scroll 20s linear infinite;
}

@keyframes matrix-scroll {
    0% { left: 0; }
    100% { left: -100%; }
}

.card-content {
    padding: 0 30px 30px 30px;
}

.avatar-wrapper {
    display: flex;
    justify-content: center;
    margin-top: -50px;
    margin-bottom: 20px;
}

.avatar {
    position: relative;
    width: 100px;
    height: 100px;
    border-radius: 50%;
    background: #e0e0e0;
    border: 5px solid white;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    overflow: hidden;
}

.avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.avatar-status-badge {
    position: absolute;
    bottom: 5px;
    right: 5px;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    border: 3px solid white;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    background: #747f8d;
}

.avatar-status-badge.online {
    background: #43b581;
}

.avatar-status-badge.idle {
    background: #faa61a;
}

.avatar-status-badge.dnd {
    background: #f04747;
}

.avatar-status-badge.offline {
    background: #747f8d;
}

.user-info {
    text-align: center;
    margin-bottom: 25px;
}

.username {
    font-size: 1.5rem;
    font-weight: 700;
    color: #00ff41;
    margin-bottom: 5px;
    text-shadow: 0 0 10px #00ff41;
    letter-spacing: 1px;
}

.user-tag {
    color: #00ff41;
    font-size: 0.95rem;
    opacity: 0.6;
    font-family: 'Courier New', monospace;
}

.section {
    margin-bottom: 25px;
}

.section-title {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    color: #00ff41;
    margin-bottom: 12px;
    letter-spacing: 2px;
    text-shadow: 0 0 5px #00ff41;
}

.section-title::before {
    content: '> ';
    color: #00ff41;
}

.bio {
    background: rgba(0, 255, 65, 0.05);
    padding: 15px;
    border-radius: 8px;
    color: #00ff41;
    line-height: 1.6;
    border: 1px solid rgba(0, 255, 65, 0.2);
    font-family: 'Courier New', monospace;
}

.activity-card {
    background: #f6f7f8;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 15px;
    transition: all 0.2s ease;
}

.activity-card:hover {
    background: #ebedef;
    transform: translateX(3px);
}

.activity-card:last-child {
    margin-bottom: 0;
}

.activity-card.playing {
    background: linear-gradient(135deg, #f6f7f8 0%, #e8f5e9 100%);
    border-left: 3px solid #43b581;
}

.activity-card.spotify-card {
    background: linear-gradient(135deg, #1DB954 0%, #1ed760 100%);
    color: white;
    flex-direction: column;
    align-items: stretch;
}

.connection-card {
    background: #f6f7f8;
    padding: 12px 15px;
    border-radius: 8px;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 12px;
    transition: all 0.2s ease;
}

.connection-card:hover {
    background: #ebedef;
    transform: translateX(3px);
}

.connection-card:last-child {
    margin-bottom: 0;
}

.connection-icon {
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    font-size: 1.3rem;
    flex-shrink: 0;
    background: white;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.connection-info {
    flex: 1;
    min-width: 0;
}

.connection-name {
    font-weight: 700;
    color: #2c2f33;
    font-size: 0.95rem;
    margin-bottom: 2px;
}

.connection-username {
    font-size: 0.85rem;
    color: #99aab5;
}

.connection-verified {
    color: #43b581;
    font-size: 1rem;
    flex-shrink: 0;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 12px;
}

.stat-card {
    background: linear-gradient(135deg, #f6f7f8 0%, #ffffff 100%);
    padding: 15px;
    border-radius: 8px;
    text-align: center;
    transition: all 0.2s ease;
    border: 2px solid transparent;
}

.stat-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    border-color: #667eea;
}

.stat-icon {
    font-size: 1.8rem;
    margin-bottom: 8px;
}

.stat-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: #2c2f33;
    margin-bottom: 4px;
}

.stat-label {
    font-size: 0.8rem;
    color: #99aab5;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.activity-icon-wrapper {
    flex-shrink: 0;
}

.activity-icon {
    width: 60px;
    height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    overflow: hidden;
    background: rgba(0,0,0,0.1);
    font-size: 2rem;
}

.activity-icon img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.activity-content {
    flex: 1;
    min-width: 0;
}

.activity-name {
    font-weight: 700;
    color: #2c2f33;
    margin-bottom: 4px;
}

.activity-details {
    font-size: 0.9rem;
    color: #99aab5;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.activity-time {
    text-align: right;
    flex-shrink: 0;
    font-weight: 700;
    color: #667eea;
    font-size: 1.1rem;
}

.spotify-card .activity-icon-wrapper {
    width: 100%;
}

.spotify-card .activity-icon {
    width: 100%;
    height: 80px;
}

.spotify-content {
    width: 100%;
}

.spotify-label {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 6px;
    opacity: 0.9;
}

.spotify-title {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 4px;
}

.spotify-subtitle {
    font-size: 0.9rem;
    opacity: 0.9;
    margin-bottom: 10px;
}

.spotify-progress {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 10px;
    font-size: 0.75rem;
}

.spotify-bar {
    flex: 1;
    height: 4px;
    background: rgba(255,255,255,0.3);
    border-radius: 2px;
    overflow: hidden;
}

.spotify-bar-fill {
    height: 100%;
    background: white;
    border-radius: 2px;
    transition: width 0.3s ease;
}

.spotify-actions {
    display: flex;
    gap: 10px;
}

.spotify-action {
    flex: 1;
    padding: 8px 12px;
    background: rgba(255,255,255,0.2);
    border-radius: 6px;
    text-align: center;
    color: white;
    text-decoration: none;
    font-size: 0.85rem;
    font-weight: 600;
    transition: background 0.2s ease;
}

.spotify-action:hover {
    background: rgba(255,255,255,0.3);
}

.footer {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(0, 255, 65, 0.2);
    text-align: center;
}

.last-update {
    color: rgba(0, 255, 65, 0.7);
    font-size: 0.85rem;
    font-family: 'Courier New', monospace;
    text-shadow: 0 0 5px rgba(0, 255, 65, 0.5);
    margin-bottom: 10px;
}

.footer-notice {
    color: rgba(0, 255, 65, 0.5);
    font-size: 0.75rem;
    line-height: 1.6;
    text-align: center;
    margin-top: 10px;
    font-style: italic;
}

.admin-footer {
    margin-top: 15px;
    padding-top: 15px;
    border-top: 1px solid rgba(255, 0, 0, 0.3);
    color: #ff4141;
    font-size: 0.8rem;
    text-align: center;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    text-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
}

@media (max-width: 600px) {
    .header h1 {
        font-size: 1.5rem;
    }
    
    .card-content {
        padding: 0 20px 20px 20px;
    }
    
    .activity-card {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .activity-time {
        width: 100%;
        text-align: left;
    }
}
</style>
</head>
<body>

<div class="container">
    <div class="schedule-slider" id="schedule-slider"></div>
    
    <div class="header">
        <h1><span class="sparkle">ğŸ”’</span><span id="header-username">yiyf667</span> æœ¬äººç¢ºèªãƒšãƒ¼ã‚¸<span class="sparkle">ğŸ”’</span></h1>
        <p class="subtitle">ACCOUNT VERIFICATION SYSTEM</p>
        
        <div class="admin-only-warning">
            <div class="warning-icon">ğŸš«</div>
            <div class="warning-content">
                <div class="warning-title">ç®¡ç†è€…å°‚ç”¨ãƒšãƒ¼ã‚¸</div>
                <div class="warning-text">
                    ã“ã®ãƒšãƒ¼ã‚¸ã¯ç®¡ç†è€…ä»¥å¤–ä½¿ç”¨ä¸å¯ã§ã™<br>
                    ä¸æ­£ã‚¢ã‚¯ã‚»ã‚¹ã¯è¨˜éŒ²ã•ã‚Œã€é€šå ±ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
                </div>
            </div>
        </div>
        
        <div class="security-notice">
            <div class="security-icon">âš ï¸</div>
            <div class="security-text">
                ã“ã®ãƒšãƒ¼ã‚¸ã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä¹—ã£å–ã‚Šå¯¾ç­–ç”¨ã§ã™<br>
                ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã§æœ¬äººç¢ºèªãŒå¯èƒ½ã§ã™
            </div>
        </div>
    </div>

    <div class="status-card">
        <div class="banner"></div>

        <div class="card-content">
            <div class="avatar-wrapper">
                <div class="avatar">
                    <img id="avatar" style="display:none;" alt="ã‚¢ãƒã‚¿ãƒ¼">
                    <div class="avatar-status-badge" id="avatar-status-badge"></div>
                </div>
            </div>

            <div class="user-info">
                <div class="username" id="username">yiyf667</div>
                <div class="user-tag" id="user-tag">@yiyf667</div>
            </div>

            <div id="about-section" class="section" style="display:none;">
                <div class="section-title">è‡ªå·±ç´¹ä»‹</div>
                <div class="bio" id="about-text"></div>
            </div>

            <div id="verification-info" class="section">
                <div class="section-title">æœ¬äººç¢ºèªã®æ–¹æ³•</div>
                <div class="verification-card">
                    <div class="access-warning">
                        <strong>âš ï¸ è­¦å‘Š:</strong> ã“ã®ãƒšãƒ¼ã‚¸ã¯ç®¡ç†è€…ï¼ˆyiyf667æœ¬äººï¼‰ã®ã¿ãŒä½¿ç”¨ã§ãã¾ã™ã€‚ç„¡æ–­ã‚¢ã‚¯ã‚»ã‚¹ã¯ç¦æ­¢ã•ã‚Œã¦ã„ã¾ã™ã€‚
                    </div>
                    <div class="verification-step">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <div class="step-title">ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª</div>
                            <div class="step-desc">ä¸Šè¨˜ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§æ›´æ–°ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„</div>
                        </div>
                    </div>
                    <div class="verification-step">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <div class="step-title">ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã®ä¸€è‡´</div>
                            <div class="step-desc">ç¾åœ¨ãƒ—ãƒ¬ã‚¤ä¸­ã®ã‚²ãƒ¼ãƒ ã‚„è´ã„ã¦ã„ã‚‹éŸ³æ¥½ãŒä¸€è‡´ã™ã‚‹ã‹ç¢ºèª</div>
                        </div>
                    </div>
                    <div class="verification-step">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <div class="step-title">ç›´æ¥é€£çµ¡</div>
                            <div class="step-desc">ä¸å¯©ãªç‚¹ãŒã‚ã‚‹å ´åˆã¯ã€åˆ¥ã®é€£çµ¡æ‰‹æ®µã§ç¢ºèªã—ã¦ãã ã•ã„</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="activity-section" class="section" style="display:none;">
                <div class="section-title">ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£</div>
                <div id="activities-container"></div>
            </div>

            <div id="connections-section" class="section" style="display:none;">
                <div class="section-title">é€£æºã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</div>
                <div id="connections-container"></div>
            </div>

            <div id="recruitment-section" class="section" style="display:none;">
                <div class="section-title">å‹Ÿé›†ä¸­</div>
                <div id="recruitment-container"></div>
            </div>

            <div id="custom-status-section" style="display:none;"></div>

            <div class="footer">
                <div class="last-update">
                    ğŸ• æœ€çµ‚æ›´æ–°: <span id="last-update">--:--:--</span>
                </div>
                <div class="footer-notice">
                    ã“ã®ãƒšãƒ¼ã‚¸ã¯5ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™<br>
                    æœ¬äººã®Discordã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åŒæœŸã—ã¦ã„ã¾ã™
                </div>
                <div class="admin-footer">
                    ğŸ”’ ç®¡ç†è€…å°‚ç”¨ | ç„¡æ–­ä½¿ç”¨å³ç¦ | All Rights Reserved
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const API_URL = 'https://api.lanyard.rest/v1/users';
const DISCORD_USER_ID = '1403167996607725629';
const REFRESH_INTERVAL = 5000;

function getRequestedUsernameFromPath() {
    try {
        const parts = location.pathname.split('/').filter(Boolean);
        if (parts.length >= 2 && parts[0].toLowerCase() === 'card') {
            return decodeURIComponent(parts[1]);
        }
    } catch (e) {
        console.warn('Could not parse username from path', e);
    }
    return null;
}

function formatElapsedTime(seconds) {
    if (!seconds || seconds < 0) return '0:00';
    const hours = Math.floor(seconds / 3600);
    const minutes = Math.floor((seconds % 3600) / 60);
    const secs = Math.floor(seconds % 60);
    if (hours > 0) {
        return `${hours}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
    }
    return `${minutes}:${String(secs).padStart(2, '0')}`;
}

function clamp01(n) {
    if (typeof n !== 'number' || !isFinite(n)) return 0;
    return Math.max(0, Math.min(1, n));
}

async function fetchStatus() {
    try {
        const url = `${API_URL}/${DISCORD_USER_ID}`;
        const response = await fetch(url);
        if (!response.ok) throw new Error('API error');
        const result = await response.json();
        
        // Lanyard APIã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼ã«å¯¾å¿œ
        const data = {
            username: result.data.discord_user.username,
            avatar_url: `https://cdn.discordapp.com/avatars/${result.data.discord_user.id}/${result.data.discord_user.avatar}.png?size=256`,
            status: result.data.discord_status,
            about: result.data.kv?.about || null,
            connections: result.data.kv?.connections ? JSON.parse(result.data.kv.connections) : null,
            recruitment: result.data.kv?.recruitment ? JSON.parse(result.data.kv.recruitment) : null,
            activities: (result.data.activities || []).map(act => ({
                name: act.name,
                state: act.state,
                details: act.details,
                start_timestamp: act.timestamps?.start ? act.timestamps.start / 1000 : null,
                end_timestamp: act.timestamps?.end ? act.timestamps.end / 1000 : null,
                image_url: act.assets?.large_image ? 
                    (act.assets.large_image.startsWith('mp:') 
                        ? `https://media.discordapp.net/${act.assets.large_image.slice(3)}`
                        : `https://cdn.discordapp.com/app-assets/${act.application_id}/${act.assets.large_image}.png`)
                    : null,
                source: act.name === 'Spotify' ? 'Spotify' : null,
                url: act.name === 'Spotify' ? `https://open.spotify.com/track/${act.sync_id}` : null,
                type: act.type
            }))
        };
        
        updateUI(data);
        updateLastUpdate();
    } catch (error) {
        console.error('Error fetching status:', error);
        document.getElementById('username').textContent = 'æ¥ç¶šã‚¨ãƒ©ãƒ¼';
    }
}

function updateUI(data) {
    if (data.username) {
        document.getElementById('username').textContent = data.username;
        document.getElementById('header-username').textContent = data.username;
        document.getElementById('user-tag').textContent = `@${data.username}`;
    }

    if (data.avatar_url) {
        const avatar = document.getElementById('avatar');
        avatar.src = data.avatar_url;
        avatar.style.display = 'block';
    }

    const avatarStatusBadge = document.getElementById('avatar-status-badge');
    if (avatarStatusBadge && data.status) {
        avatarStatusBadge.className = `avatar-status-badge ${data.status}`;
    }

    const aboutSection = document.getElementById('about-section');
    if (data.about) {
        aboutSection.style.display = 'block';
        document.getElementById('about-text').textContent = data.about;
    } else {
        aboutSection.style.display = 'none';
    }

    const activitySection = document.getElementById('activity-section');
    const activitiesContainer = document.getElementById('activities-container');
    
    if (data.activities && data.activities.length > 0) {
        activitySection.style.display = 'block';
        activitiesContainer.innerHTML = '';
        
        data.activities.forEach(activity => {
            const activityCard = document.createElement('div');
            const isSpotify = activity && activity.source === 'Spotify';
            const now = new Date();

            if (isSpotify) {
                const startTime = activity.start_timestamp ? new Date(activity.start_timestamp * 1000) : null;
                const endTime = activity.end_timestamp ? new Date(activity.end_timestamp * 1000) : null;
                const elapsedSeconds = startTime ? (now - startTime) / 1000 : 0;
                const durationSeconds = (startTime && endTime) ? Math.max(0, (endTime - startTime) / 1000) : 0;
                const progress = durationSeconds > 0 ? clamp01(elapsedSeconds / durationSeconds) : 0;

                const title = activity.name || 'Spotify';
                const artist = activity.state || '';
                const album = activity.details || '';
                const trackUrl = activity.url || 'https://open.spotify.com';

                activityCard.className = 'activity-card spotify-card';
                activityCard.innerHTML = `
                    <div class="activity-icon-wrapper">
                        <div class="activity-icon">
                            ${activity.image_url ? `<img src="${activity.image_url}" alt="${title}">` : 'ğŸµ'}
                        </div>
                    </div>
                    <div class="spotify-content">
                        <div class="spotify-label">Spotifyã‚’å†ç”Ÿä¸­</div>
                        <div class="spotify-title">${title}</div>
                        <div class="spotify-subtitle">${[artist, album].filter(Boolean).join(' â€¢ ')}</div>
                        <div class="spotify-progress">
                            <div class="spotify-time">${formatElapsedTime(elapsedSeconds)}</div>
                            <div class="spotify-bar" role="progressbar" aria-valuenow="${Math.round(progress * 100)}" aria-valuemin="0" aria-valuemax="100">
                                <div class="spotify-bar-fill" style="width: ${Math.round(progress * 100)}%"></div>
                            </div>
                            <div class="spotify-time">${durationSeconds > 0 ? formatElapsedTime(durationSeconds) : '--:--'}</div>
                        </div>
                        <div class="spotify-actions">
                            <a class="spotify-action" href="${trackUrl}" target="_blank" rel="noopener noreferrer">ä¸€ç·’ã«è´ã</a>
                            <a class="spotify-action" href="https://open.spotify.com" target="_blank" rel="noopener noreferrer">Spotifyã«æ¥ç¶š</a>
                        </div>
                    </div>
                `;
                activitiesContainer.appendChild(activityCard);
                return;
            }

            let isPlaying = false;
            if (activity.type) {
                try {
                    const typeStr = String(activity.type).toLowerCase();
                    if (typeStr.includes('play')) isPlaying = true;
                } catch (e) {}
            }
            if (!activity.state && !activity.details) {
                isPlaying = true;
            }

            activityCard.className = 'activity-card' + (isPlaying ? ' playing' : '');

            const details = [];
            if (activity.state) details.push(activity.state);
            if (activity.details) details.push(activity.details);

            const elapsed = activity.start_timestamp
                ? formatElapsedTime((now - new Date(activity.start_timestamp * 1000)) / 1000)
                : '0:00';

            activityCard.innerHTML = `
                <div class="activity-icon-wrapper">
                    <div class="activity-icon">
                        ${activity.image_url ? `<img src="${activity.image_url}" alt="${activity.name}">` : 'ğŸ®'}
                    </div>
                </div>
                <div class="activity-content">
                    <div class="activity-name">${activity.name}</div>
                    <div class="activity-details">${details.length > 0 ? details.join(' â€¢ ') : 'â–¶ï¸ ãƒ—ãƒ¬ã‚¤ä¸­'}</div>
                </div>
                <div class="activity-time">${elapsed}</div>
            `;
            activitiesContainer.appendChild(activityCard);
        });
    } else {
        activitySection.style.display = 'none';
    }

    // é€£æºã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®è¡¨ç¤º
    const connectionsSection = document.getElementById('connections-section');
    const connectionsContainer = document.getElementById('connections-container');
    
    if (data.connections && data.connections.length > 0) {
        connectionsSection.style.display = 'block';
        connectionsContainer.innerHTML = '';
        
        const connectionIcons = {
            'spotify': 'ğŸµ',
            'youtube': 'â–¶ï¸',
            'twitch': 'ğŸ’œ',
            'twitter': 'ğŸ¦',
            'github': 'ğŸ™',
            'steam': 'ğŸ®',
            'reddit': 'ğŸ¤–',
            'xbox': 'ğŸ®',
            'playstation': 'ğŸ®',
            'battlenet': 'âš”ï¸',
            'epicgames': 'ğŸ®',
            'leagueoflegends': 'ğŸ®',
            'facebook': 'ğŸ‘¤',
            'instagram': 'ğŸ“·',
            'tiktok': 'ğŸµ'
        };
        
        data.connections.forEach(connection => {
            const connCard = document.createElement('div');
            connCard.className = 'connection-card';
            
            const icon = connectionIcons[connection.type.toLowerCase()] || 'ğŸ”—';
            const typeName = connection.type.charAt(0).toUpperCase() + connection.type.slice(1);
            
            connCard.innerHTML = `
                <div class="connection-icon">${icon}</div>
                <div class="connection-info">
                    <div class="connection-name">${typeName}</div>
                    <div class="connection-username">${connection.name}</div>
                </div>
                ${connection.verified ? '<div class="connection-verified">âœ“</div>' : ''}
            `;
            
            connectionsContainer.appendChild(connCard);
        });
    } else {
        connectionsSection.style.display = 'none';
    }

    // å‹Ÿé›†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¡¨ç¤º
    const recruitmentSection = document.getElementById('recruitment-section');
    const recruitmentContainer = document.getElementById('recruitment-container');
    
    if (data.recruitment && data.recruitment.length > 0) {
        recruitmentSection.style.display = 'block';
        recruitmentContainer.innerHTML = '';
        
        data.recruitment.forEach(item => {
            const recruitCard = document.createElement('div');
            recruitCard.className = 'recruitment-card';
            
            const statusClass = item.status === 'open' ? 'open' : 'closed';
            const statusText = item.status === 'open' ? 'å‹Ÿé›†ä¸­' : 'ç· åˆ‡';
            
            let tagsHTML = '';
            if (item.tags && item.tags.length > 0) {
                item.tags.forEach(tag => {
                    tagsHTML += `<div class="recruitment-tag">${tag}</div>`;
                });
            }
            
            recruitCard.innerHTML = `
                <div class="recruitment-header">
                    <div class="recruitment-title">
                        <span class="recruitment-icon">${item.icon || 'ğŸ“¢'}</span>
                        ${item.title}
                    </div>
                    <div class="recruitment-status ${statusClass}">${statusText}</div>
                </div>
                <div class="recruitment-description">${item.description}</div>
                ${tagsHTML ? `<div class="recruitment-details">${tagsHTML}</div>` : ''}
                ${item.link ? `<a class="recruitment-link" href="${item.link}" target="_blank" rel="noopener noreferrer">è©³ç´°ã‚’è¦‹ã‚‹ â†’</a>` : ''}
            `;
            
            recruitmentContainer.appendChild(recruitCard);
        });
    } else {
        recruitmentSection.style.display = 'none';
    }
}

function updateLastUpdate() {
    document.getElementById('last-update').textContent = new Date().toLocaleTimeString('ja-JP');
}

function addCardTilt() {
    const card = document.querySelector('.status-card');
    if (!card) return;

    const maxDeg = 12;
    const scaleOnHover = 1.02;

    function handleMove(e) {
        const rect = card.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const halfW = rect.width / 2;
        const halfH = rect.height / 2;
        const rotateY = ((x - halfW) / halfW) * maxDeg;
        const rotateX = -((y - halfH) / halfH) * maxDeg;
        card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(${scaleOnHover})`;
        card.style.boxShadow = '0 20px 40px rgba(0,0,0,0.12)';
    }

    function handleLeave() {
        card.style.transform = '';
        card.style.boxShadow = '';
    }

    card.addEventListener('mousemove', handleMove);
    card.addEventListener('touchmove', function(e){
        if (e.touches && e.touches[0]) handleMove(e.touches[0]);
    }, {passive: true});
    card.addEventListener('mouseleave', handleLeave);
    card.addEventListener('touchend', handleLeave);
}

function init() {
    console.log('Status display initialized');
    const requested = getRequestedUsernameFromPath();
    if (requested) {
        document.getElementById('username').textContent = requested;
        document.getElementById('header-username').textContent = requested;
        document.getElementById('user-tag').textContent = `@${requested}`;
    } else {
        // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼å
        document.getElementById('username').textContent = 'yiyf667';
        document.getElementById('header-username').textContent = 'yiyf667';
        document.getElementById('user-tag').textContent = '@yiyf667';
    }
    fetchStatus();
    try {
        addCardTilt();
    } catch (e) {
        console.warn('addCardTilt failed', e);
    }
    setInterval(fetchStatus, REFRESH_INTERVAL);
}

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
} else {
    init();
}
</script>

</body>
</html>
